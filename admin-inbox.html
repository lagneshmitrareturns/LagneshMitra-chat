<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LagneshMitra ‚Äì Admin Inbox</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:"Segoe UI",Roboto,Arial,sans-serif;
  background:linear-gradient(135deg,#1b0f2e,#2b1055);
  color:#fff;
  height:100vh;
  overflow:hidden;
}

/* TOP BAR */
.top-bar{
  height:72px;
  background:#1f1433;
  border-bottom:1px solid #3b2463;
  display:flex;
  align-items:center;
  padding:0 22px;
}
.top-bar h2{
  margin:0;
  font-size:20px;
  color:#ff5da2;
}
.back-btn{
  margin-left:auto;
  background:#2a1650;
  color:#fff;
  border:none;
  padding:12px 18px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
}

/* LAYOUT */
.container{
  display:flex;
  height:calc(100vh - 72px);
}

/* SIDEBAR */
.sidebar{
  width:220px;
  background:#1a0f2e;
  border-right:1px solid #3b2463;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.side-btn{
  padding:12px 14px;
  border-radius:12px;
  border:none;
  background:#2a1650;
  color:#fff;
  cursor:pointer;
  text-align:left;
  font-weight:600;
}
.side-btn.active{
  background:linear-gradient(135deg,#ff5da2,#9b5cff);
  color:#1b0f2e;
}

/* INBOX TABLE */
.inbox{
  width:45%;
  background:#24123d;
  border-right:1px solid #3b2463;
  overflow-y:auto;
}
.table-head,
.table-row{
  display:grid;
  grid-template-columns: 1.4fr 1.6fr 1fr;
  padding:14px 16px;
  align-items:center;
}
.table-head{
  position:sticky;
  top:0;
  background:#1f1433;
  font-size:13px;
  color:#c4b5fd;
  border-bottom:1px solid #3b2463;
  z-index:2;
}
.table-row{
  border-bottom:1px solid #3b2463;
  cursor:pointer;
}
.table-row:hover{
  background:#2a1650;
}
.name{
  font-weight:700;
  color:#ffb4dc;
}
.report{
  font-size:14px;
  color:#e9d5ff;
}
.status select{
  background:#3b2463;
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:14px;
  font-size:12px;
  cursor:pointer;
}

/* DETAIL PANEL */
.detail{
  width:55%;
  padding:22px;
  overflow-y:auto;
}
.empty{
  opacity:.7;
  font-style:italic;
  color:#c4b5fd;
}
.detail h3{
  margin-top:0;
  color:#ff5da2;
}
.section{
  margin-bottom:18px;
}
.section label{
  font-size:13px;
  color:#c4b5fd;
}
.section div{
  margin-top:4px;
  font-size:15px;
}
</style>
</head>

<body>

<div class="top-bar">
  <h2>üìÆ Admin Inbox</h2>
  <button class="back-btn" onclick="location.href='admin-posts.html'">‚Ü© Back</button>
</div>

<div class="container">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <button class="side-btn active" data-box="inbox">üì• Inbox</button>
    <button class="side-btn" data-box="sent">üì§ Sent</button>
    <button class="side-btn" data-box="draft">üìù Drafts</button>
    <button class="side-btn" data-box="archive">üóÑ Archive</button>
  </div>

  <!-- INBOX -->
  <div class="inbox">
    <div class="table-head">
      <div>Name</div>
      <div>Report Wanted</div>
      <div>Status</div>
    </div>
    <div id="list"></div>
  </div>

  <!-- DETAIL -->
  <div class="detail" id="detail">
    <div class="empty">Select a message</div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  query,
  orderBy,
  onSnapshot,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyCX8yGRJc5AcxSEaaC6AzNLZzxtOCz83Sk",
  authDomain:"lagneshmitra-e57b8.firebaseapp.com",
  projectId:"lagneshmitra-e57b8"
});
const db = getFirestore(app);

const list = document.getElementById("list");
const detail = document.getElementById("detail");
let currentBox = "inbox";
let unsubscribe = null;

/* SIDEBAR */
document.querySelectorAll(".side-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".side-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentBox = btn.dataset.box;
    attachListener();
  };
});

/* LISTENER */
function attachListener(){
  if(unsubscribe) unsubscribe();
  list.innerHTML = "";

  const q = query(collection(db,"cases"), orderBy("createdAt","desc"));

  unsubscribe = onSnapshot(q, snap=>{
    list.innerHTML = "";
    snap.forEach(d=>{
      const c = d.data();
      const id = d.id;

      if(
        (currentBox==="inbox" && c.status==="Query Submitted") ||
        (currentBox==="sent" && c.status==="Replied") ||
        (currentBox==="draft" && c.status==="Draft") ||
        (currentBox==="archive" && c.status==="Closed")
      ){
        const row = document.createElement("div");
        row.className="table-row";
        row.innerHTML = `
          <div class="name">${c.name || "Unknown"}</div>
          <div class="report">${c.queryType || ""}</div>
          <div class="status">
            <select>
              <option ${c.status==="Query Submitted"?"selected":""}>Query Submitted</option>
              <option ${c.status==="Under Scrutiny"?"selected":""}>Under Scrutiny</option>
              <option ${c.status==="Replied"?"selected":""}>Replied</option>
              <option ${c.status==="Draft"?"selected":""}>Draft</option>
              <option ${c.status==="Closed"?"selected":""}>Closed</option>
            </select>
          </div>
        `;

        row.querySelector("select").onchange = e=>{
          updateDoc(doc(db,"cases",id),{ status:e.target.value });
        };

        row.onclick = ()=>openCase(c);
        list.appendChild(row);
      }
    });

    if(!list.innerHTML){
      list.innerHTML = `<div class="empty" style="padding:18px;">No messages</div>`;
    }
  });
}

/* OPEN DETAIL */
function openCase(c){
  detail.innerHTML = `
    <h3>${c.name || ""}</h3>

    <div class="section"><label>WhatsApp</label><div>${c.whatsapp || ""}</div></div>
    <div class="section"><label>Query Type</label><div>${c.queryType || ""}</div></div>
    <div class="section"><label>Message</label><div>${c.message || ""}</div></div>

    <div class="section">
      <label>Birth Details</label>
      <div>DOB: ${c.dob || ""}</div>
      <div>TOB: ${c.tob || ""}</div>
      <div>POB: ${c.pob || ""}</div>
    </div>

    <div class="section"><label>Status</label><div>${c.status}</div></div>
  `;
}

attachListener();
</script>

</body>
</html>
