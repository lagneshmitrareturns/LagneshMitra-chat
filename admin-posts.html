l<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LagneshMitra ‚Äì Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ================== BASE ================== */
body{
  margin:0;
  font-family:"Segoe UI",Roboto,Arial,sans-serif;
  background:linear-gradient(135deg,#1b0f2e,#2b1055);
  color:#fff;
  height:100vh;
  overflow:hidden;
}

/* ================== LABEL ================== */
.system-label{
  position:fixed;
  top:14px;
  left:18px;
  z-index:300;
  font-size:13px;
  font-style:italic;
  color:#d8b4fe;
}
.system-label strong{
  display:block;
  font-size:15px;
  color:#ff5da2;
}

/* ================== TOP BAR ================== */
.top-bar{
  position:fixed;
  top:54px;
  left:0;
  width:100%;
  height:76px;
  display:flex;
  align-items:center;
  gap:14px;
  padding:0 22px;
  background:#1f1433;
  border-bottom:1px solid #3b2463;
  z-index:200;
}

/* ================== BUTTONS ================== */
.menu-main{
  padding:14px 22px;
  border-radius:16px;
  border:none;
  font-size:14px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,#ff5da2,#d946ef);
  color:#1b0f2e;
}

.menu-main.alt{
  background:#2a1650;
  color:#fff;
}

.menu-main.back-btn{
  margin-left:auto;
  background:#2a1650;
  color:#fff;
}

/* ================== DROPDOWN ================== */
.menu-group{
  position:relative;
}

.dropdown{
  position:absolute;
  top:70px;
  left:0;
  min-width:220px;
  background:#2a1650;
  border-radius:16px;
  box-shadow:0 18px 40px rgba(0,0,0,.6);
  display:none;
  overflow:hidden;
  z-index:500;
}

.dropdown button{
  width:100%;
  background:none;
  border:none;
  color:#fff;
  padding:14px 18px;
  text-align:left;
  cursor:pointer;
  font-size:14px;
}

.dropdown button:hover{
  background:#3b2463;
}

/* ================== WORKSPACE ================== */
.workspace{
  position:absolute;
  top:130px;
  left:0;
  width:100%;
  height:calc(100vh - 130px);
  background:#24123d;
}
.workspace-inner{
  height:100%;
  overflow-y:auto;
  padding:24px;
  max-width:900px;
  margin:auto;
}
.empty{
  color:#c4b5fd;
  font-style:italic;
  opacity:.75;
}

/* ================== FORMS ================== */
.form-shell{
  height:100%;
  display:flex;
  flex-direction:column;
  gap:12px;
  position:relative;
}
textarea{
  flex:1;
  padding:16px;
  border-radius:16px;
  border:none;
  font-size:15px;
  background:#fff;
  color:#111;
  resize:none;
}
.close-x{
  position:absolute;
  top:6px;
  right:6px;
  cursor:pointer;
  opacity:.7;
}
.close-x:hover{opacity:1;}

.ops-toggle{
  position:absolute;
  top:6px;
  right:44px;
  background:#2a1650;
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:12px;
  cursor:pointer;
}

.ops-panel{
  display:none;
  background:#1f1433;
  border-radius:16px;
  padding:14px;
  gap:10px;
  flex-wrap:wrap;
}
.ops-panel button{
  background:#3b2463;
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
}
.ops-panel .publish-btn{
  background:linear-gradient(135deg,#ff5da2,#d946ef);
  color:#1b0f2e;
  font-weight:700;
}
.ops-panel .feature-btn{
  background:#ffd166;
  color:#1b0f2e;
  font-weight:700;
}

/* ================== TABLE ================== */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #3b2463;
  font-size:13px;
}
th{ color:#c4b5fd; text-align:left; }
tr:hover{ background:#2a1650; cursor:pointer; }
</style>
</head>

<body>

<!-- LABEL -->
<div class="system-label">
  <strong>LagneshMitra Intelligence System</strong>
  Version 1.0
</div>

<!-- TOP BAR -->
<div class="top-bar">

  <!-- HALL OF FAME MENU -->
  <div class="menu-group">
    <button class="menu-main" onclick="toggleDD(event)">üèÜ Hall of Fame ‚ñæ</button>
    <div class="dropdown" id="hofDD">
      <button onclick="menuAction(loadAdd)">‚ûï Add Post</button>
      <button onclick="menuAction(loadEditLatest)">‚úè Edit Latest</button>
      <button onclick="menuAction(loadManage)">üìã Manage Posts</button>
    </div>
  </div>

  <button class="menu-main alt" onclick="openInbox()">üì© Email / Chat</button>
  <button class="menu-main back-btn" onclick="goHome()">‚Ü© Back to Site</button>
</div>

<!-- WORKSPACE -->
<div class="workspace">
  <div class="workspace-inner" id="workspace">
    <div class="empty">Select an admin function above</div>
  </div>
</div>

<!-- ================== LOGIC ================== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs,
  doc, updateDoc, getDoc,
  serverTimestamp, query, orderBy, limit
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyCX8yGRJc5AcxSEaaC6AzNLZzxtOCz83Sk",
  authDomain:"lagneshmitra-e57b8.firebaseapp.com",
  projectId:"lagneshmitra-e57b8"
});
const db = getFirestore(app);

const ws=document.getElementById("workspace");
let selectedPostId=null;

/* NAV */
window.goHome=()=>location.href="index.html";
window.openInbox=()=>location.href="admin-inbox.html";

/* DROPDOWN */
window.toggleDD=(e)=>{
  e.stopPropagation();
  const dd=document.getElementById("hofDD");
  dd.style.display = dd.style.display==="block" ? "none" : "block";
};
window.menuAction=(fn)=>{
  document.getElementById("hofDD").style.display="none";
  fn();
};
document.addEventListener("click",()=>{
  document.getElementById("hofDD").style.display="none";
});

/* UTILS */
window.clearWS=()=>ws.innerHTML=`<div class="empty">Select an admin function above</div>`;
window.toggleOps=()=>{
  const p=document.getElementById("opsPanel");
  if(p)p.style.display=p.style.display==="flex"?"none":"flex";
};

/* ADD */
window.loadAdd=()=>{
  selectedPostId=null;
  ws.innerHTML=`
  <div class="form-shell">
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <button class="ops-toggle" onclick="toggleOps()">‚öô Controls</button>
    <div class="ops-panel" id="opsPanel">
      <button class="publish-btn" onclick="savePost()">Publish</button>
    </div>
    <h3>Add Hall of Fame Post</h3>
    <textarea id="postContent"></textarea>
  </div>`;
};

/* EDIT LATEST */
window.loadEditLatest=async()=>{
  const q=query(collection(db,"posts"),orderBy("updatedAt","desc"),limit(1));
  const snap=await getDocs(q);
  if(snap.empty)return;

  const d=snap.docs[0];
  selectedPostId=d.id;

  ws.innerHTML=`
  <div class="form-shell">
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <button class="ops-toggle" onclick="toggleOps()">‚öô Controls</button>
    <div class="ops-panel" id="opsPanel">
      <button class="publish-btn" onclick="savePost()">Republish</button>
      <button class="feature-btn" onclick="setFeatured('${d.id}')">‚≠ê Set as Front Page</button>
    </div>
    <h3>Edit Latest Post</h3>
    <textarea id="postContent">${d.data().content}</textarea>
  </div>`;
};

/* MANAGE */
window.loadManage=async()=>{
  ws.innerHTML=`
  <div class="form-shell">
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <h3>Manage Posts</h3>
    <table>
      <thead><tr><th>Date</th><th>Preview</th><th>Views</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>`;

  const rows=document.getElementById("rows");
  const q=query(collection(db,"posts"),orderBy("updatedAt","desc"));
  const snap=await getDocs(q);

  snap.forEach(d=>{
    rows.innerHTML+=`
    <tr onclick="editFromTable('${d.id}')">
      <td>${new Date(d.data().updatedAt.seconds*1000).toLocaleString()}</td>
      <td>${d.data().content.slice(0,50)}...</td>
      <td>${d.data().views||0}</td>
    </tr>`;
  });
};

/* EDIT FROM TABLE */
window.editFromTable=async(id)=>{
  const snap=await getDoc(doc(db,"posts",id));
  selectedPostId=id;

  ws.innerHTML=`
  <div class="form-shell">
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <button class="ops-toggle" onclick="toggleOps()">‚öô Controls</button>
    <div class="ops-panel" id="opsPanel">
      <button class="publish-btn" onclick="savePost()">Republish</button>
      <button class="feature-btn" onclick="setFeatured('${id}')">‚≠ê Set as Front Page</button>
    </div>
    <h3>Edit Post</h3>
    <textarea id="postContent">${snap.data().content}</textarea>
  </div>`;
};

/* FEATURE */
window.setFeatured=async(postId)=>{
  const snap=await getDocs(collection(db,"posts"));
  snap.forEach(async d=>{
    await updateDoc(doc(db,"posts",d.id),{featured:false});
  });
  await updateDoc(doc(db,"posts",postId),{
    featured:true,
    updatedAt:serverTimestamp()
  });
  alert("Front page updated");
};

/* SAVE */
window.savePost=async()=>{
  const text=document.getElementById("postContent").value.trim();
  if(!text)return;

  if(selectedPostId){
    await updateDoc(doc(db,"posts",selectedPostId),{
      content:text,
      updatedAt:serverTimestamp()
    });
  }else{
    await addDoc(collection(db,"posts"),{
      content:text,
      views:0,
      featured:false,
      createdAt:serverTimestamp(),
      updatedAt:serverTimestamp()
    });
  }
  clearWS();
};
</script>

</body>
</html>
