<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LagneshMitra ‚Äì Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== BASE ===== */
body{
  margin:0;
  font-family:"Segoe UI",Roboto,Arial,sans-serif;
  background:linear-gradient(135deg,#1b0f2e,#2b1055);
  color:#fff;
  height:100vh;
  overflow:hidden;
}

/* ===== SYSTEM LABEL ===== */
.system-label{
  position:fixed;
  top:14px;
  left:18px;
  z-index:300;
  font-size:13px;
  font-style:italic;
  color:#d8b4fe;
}
.system-label strong{
  display:block;
  font-size:15px;
  color:#ff5da2;
}

/* ===== TOP COMMAND BAR ===== */
.top-bar{
  position:fixed;
  top:54px;
  left:0;
  width:100%;
  height:76px;
  display:flex;
  align-items:center;
  gap:22px;
  padding:0 22px;
  background:#1f1433;
  border-bottom:1px solid #3b2463;
  z-index:200;
}

/* ===== MENU GROUP ===== */
.menu-group{ position:relative; }

.menu-main{
  padding:14px 22px;
  border-radius:16px;
  border:none;
  font-size:14px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,#ff5da2,#d946ef);
  color:#1b0f2e;
}

/* BACK BUTTON */
.back-btn{
  margin-left:auto;
  background:#2a1650;
  color:#fff;
}

/* ===== DROPDOWN ===== */
.dropdown{
  position:absolute;
  top:64px;
  left:0;
  min-width:220px;
  background:#2a1650;
  border-radius:16px;
  box-shadow:0 18px 40px rgba(0,0,0,.6);
  display:none;
  overflow:hidden;
  z-index:500;
}
.dropdown button{
  width:100%;
  background:none;
  border:none;
  color:#fff;
  padding:14px 18px;
  text-align:left;
  cursor:pointer;
  font-size:14px;
}
.dropdown button:hover{ background:#3b2463; }
.dropdown button:disabled{opacity:.5;}

/* ===== WORKSPACE ===== */
.workspace{
  position:absolute;
  top:130px;
  left:0;
  width:100%;
  height:calc(100vh - 130px);
  background:#24123d;
}

.workspace-inner{
  height:100%;
  overflow-y:auto;
  padding:26px;
  box-sizing:border-box;
  max-width:860px;
  margin:auto;
}

/* ===== EMPTY ===== */
.empty{
  color:#c4b5fd;
  font-style:italic;
  opacity:.75;
}

/* ===== CLOSE X ===== */
.close-x{
  position:absolute;
  top:18px;
  right:18px;
  font-size:18px;
  cursor:pointer;
  opacity:.7;
}
.close-x:hover{opacity:1;}

/* ===== FORM ===== */
textarea{
  width:100%;
  min-height:240px;
  padding:16px;
  border-radius:14px;
  border:none;
  font-size:15px;
  background:#fff;
  color:#111;
}

.action{ margin-top:14px; margin-right:8px; }
.danger{ background:#7f1d1d; color:#fff; }

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:16px;
}
th,td{
  padding:10px;
  border-bottom:1px solid #3b2463;
  font-size:13px;
}
th{ color:#c4b5fd; text-align:left; }
tr:hover{ background:#2a1650; cursor:pointer; }
</style>
</head>

<body>

<div class="system-label">
  <strong>LagneshMitra Intelligence System</strong>
  Version 1.0
</div>

<div class="top-bar">

  <div class="menu-group">
    <button class="menu-main" onclick="toggleDD('hof-dd')">Hall of Fame ‚ñæ</button>
    <div class="dropdown" id="hof-dd">
      <button onclick="loadAdd()">‚ûï Add Post</button>
      <button onclick="loadEditLatest()">‚úè Edit Latest</button>
      <button onclick="loadManage()">üìã Manage Posts</button>
    </div>
  </div>

  <div class="menu-group">
    <button class="menu-main" disabled>ZENO ‚ñæ</button>
  </div>

  <div class="menu-group">
    <button class="menu-main" disabled>Mail ‚ñæ</button>
  </div>

  <div class="menu-group">
    <button class="menu-main" disabled>Payments ‚ñæ</button>
  </div>

  <!-- BACK TO INDEX -->
  <button class="menu-main back-btn" onclick="goHome()">‚Ü© Back to Site</button>

</div>

<div class="workspace">
  <div class="workspace-inner" id="workspace">
    <div class="empty">Select a module from the top menu</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs,
  doc, updateDoc, getDoc,
  serverTimestamp, query, orderBy, limit
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyCX8yGRJc5AcxSEaaC6AzNLZzxtOCz83Sk",
  authDomain:"lagneshmitra-e57b8.firebaseapp.com",
  projectId:"lagneshmitra-e57b8"
});
const db = getFirestore(app);
const ws = document.getElementById("workspace");
let selectedPostId=null;

/* NAV */
window.goHome=()=>window.open("/", "_blank");

/* DROPDOWN */
window.toggleDD=id=>{
  document.querySelectorAll(".dropdown").forEach(d=>d.style.display="none");
  document.getElementById(id).style.display="block";
};
document.addEventListener("click",e=>{
  if(!e.target.closest(".menu-group")){
    document.querySelectorAll(".dropdown").forEach(d=>d.style.display="none");
  }
});

/* CLEAR */
window.clearWS=()=>{
  ws.innerHTML=`<div class="empty">Select a module from the top menu</div>`;
};

/* ADD */
window.loadAdd=()=>{
  selectedPostId=null;
  ws.innerHTML=`
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <h3>Add Hall of Fame Post</h3>
    <textarea id="postContent"></textarea>
    <button class="action" onclick="savePost()">Publish</button>
  `;
};

/* EDIT LATEST */
window.loadEditLatest=async()=>{
  const q=query(collection(db,"posts"),orderBy("updatedAt","desc"),limit(1));
  const snap=await getDocs(q);
  if(snap.empty)return;
  const d=snap.docs[0];
  selectedPostId=d.id;
  ws.innerHTML=`
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <h3>Edit Latest Post</h3>
    <textarea id="postContent">${d.data().content}</textarea>
    <button class="action" onclick="savePost()">Republish</button>
  `;
};

/* MANAGE */
window.loadManage=async()=>{
  ws.innerHTML=`
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <h3>Manage Posts</h3>
    <table>
      <thead><tr><th>Date</th><th>Preview</th><th>Views</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  `;
  const q=query(collection(db,"posts"),orderBy("updatedAt","desc"));
  const snap=await getDocs(q);
  snap.forEach(d=>{
    rows.innerHTML+=`
      <tr onclick="editFromTable('${d.id}')">
        <td>${new Date(d.data().updatedAt.seconds*1000).toLocaleString()}</td>
        <td>${d.data().content.slice(0,40)}...</td>
        <td>${d.data().views||0}</td>
      </tr>`;
  });
};

window.editFromTable=async(id)=>{
  const snap=await getDoc(doc(db,"posts",id));
  selectedPostId=id;
  ws.innerHTML=`
    <div class="close-x" onclick="clearWS()">‚úï</div>
    <h3>Edit Post</h3>
    <textarea id="postContent">${snap.data().content}</textarea>
    <button class="action" onclick="savePost()">Republish</button>
  `;
};

/* SAVE */
window.savePost=async()=>{
  const text=postContent.value.trim();
  if(!text)return;
  if(selectedPostId){
    await updateDoc(doc(db,"posts",selectedPostId),{
      content:text,
      updatedAt:serverTimestamp()
    });
  }else{
    await addDoc(collection(db,"posts"),{
      content:text,views:0,
      createdAt:serverTimestamp(),
      updatedAt:serverTimestamp()
    });
  }
  clearWS();
};
</script>

</body>
</html>
